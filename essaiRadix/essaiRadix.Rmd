---
title: "`randomForest` v.s. `ranger`"
author:
- affiliation: Centre Inserm U1219
  affiliation_url: https://bph.center
  name: Robin Genuer
  url: https://robin.genuer.fr
date: "`r Sys.Date()`"
output: radix::radix_article
description: |
  A small comparison between random forests implementations in R.
bibliography: essaiRadix.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      R.options = list(width = 60))
```


```{r}
if (!requireNamespace(c("microbenchmark", "randomForest", "ranger"), quietly = TRUE)) {
    install.packages(c("microbenchmark", "randomForest", "ranger"))}
```


```{r}
library(microbenchmark)
ncores <- 3
```

# `toys` data in dimension 200

Data are available in the `VSURF` package @vsurfpackage.

Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla Blablabla pour voir la largeur du texte.

```{r}
data(toys, package = "VSURF")
dim(toys$x)
str(toys$y)
toysData <- data.frame(toys$x, y = toys$y)
mtryToys <- floor(ncol(toys$x)/3)
```

```{r, results='hide', echo=FALSE}
mbToys <- microbenchmark::microbenchmark(
  randomForest::randomForest(y ~ ., toysData, ntree = 100, mtry = mtryToys),
  randomForest::randomForest(toys$x, toys$y, ntree = 100, mtry = mtryToys),
  ranger::ranger(y ~ ., toysData, num.trees = 100, mtry = mtryToys,
                 num.threads = 1),
  ranger::ranger(y ~ ., toysData, num.trees = 100, mtry = mtryToys,
                 num.threads = ncores),
  times = 10)
mbToysPrint <- print(mbToys)
```

```{r}
knitr::kable(mbToysPrint)
```

```{r computTimeCompar, layout="l-body-outset", fig.width=10, fig.height=6, fig.cap="Comparison of computation time between several random forests implementations and statements."}
boxplot(mbToys, names = c("RF formula", "RF",
                           "ranger", "rangerPara"))
```

Comme on peut le voir dans la figure \@ref(fig:computTimeCompar) la fonction
`ranger()` [@rangerarticle] est plus rapide pour construire une forêt aléatoire dans ce cadre.

## With variable importance computation

```{r, results='hide', echo=FALSE}
mbToysImp <- microbenchmark::microbenchmark(
  randomForest::randomForest(y ~ ., toysData, ntree = 100, importance = TRUE,
                             mtry = mtryToys),
  randomForest::randomForest(toys$x, toys$y, ntree = 100, importance = TRUE,
                             mtry = mtryToys),
  ranger::ranger(y ~ ., toysData, num.trees = 100, importance = "permutation",
                 mtry = mtryToys, num.threads = 1),
  ranger::ranger(y ~ ., toysData, num.trees = 100, importance = "permutation",
                 mtry = mtryToys, num.threads = ncores),
  times = 10)
mbToysImpPrint <- print(mbToysImp)

```

```{r, layout="l-page"}
rmarkdown::paged_table(mbToysImpPrint, options = list(col.print = 4))
```


```{r computTimeComparImp, fig.width=6, fig.height=4, fig.cap="Comparison of computation time between several random forests implementations and statements when importance variable is computed."}
boxplot(mbToysImp, names = c("RF formula", "RF",
                           "ranger", "rangerPara"))
```

Quand on calcule l'importance des variables, `ranger()` est effet plus lente
sur cet exemple que `randomForest()` (\@ref(fig:computTimeComparImp)).
